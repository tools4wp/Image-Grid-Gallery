{% schema %}
{
  "name": "Grid Layout",
  "settings": [
    {
      "type": "range",
      "id": "t4wp_grid_column_size",
      "label": "Grid Column Size (1-9)",
      "min": 1,
      "max": 9,
      "default": 3
    },
    {
      "type": "header",
      "content": "Desktop"
    },
    {
      "type": "checkbox",
      "id": "t4wp_full_width",
      "label": "Full Width",
      "default": false
    },
    {
      "type": "range",
      "id": "t4wp_container_width",
      "label": "Container Width (px)",
      "min": 900,
      "max": 1200,
      "default": 1100,
      "step": 10,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "t4wp_grid_gap",
      "label": "Grid Gap (0-20px)",
      "min": 0,
      "max": 20,
      "default": 7,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "t4wp_image_radius",
      "label": "Block Radius (0-50px)",
      "min": 0,
      "max": 50,
      "default": 0,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "t4wp_padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Top",
      "default": 36
    },
    {
      "type": "range",
      "id": "t4wp_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding Bottom",
      "default": 36
    },
    {
      "type": "range",
      "id": "t4wp_grid_height",
      "min": 200,
      "max": 1200,
      "step": 10,
      "unit": "px",
      "label": "Grid Height",
      "default": 400
    },
    {
      "type": "header",
      "content": "Extra"
    },
    {
      "type": "checkbox",
      "id": "t4wp_remove_bottom_margin",
      "default": false,
      "label": "Remove Bottom Margin"
    }
  ],
  "blocks": [
    {
      "type": "image_block",
      "name": "Image Block",
      "settings": [
        {
          "type": "image_picker",
          "id": "t4wp_image",
          "label": "Image"
        },
        {
          "type": "url",
          "id": "t4wp_link",
          "label": "Image Link"
        },
        {
          "type": "header",
          "content": "Position"
        },
        {
          "type": "range",
          "id": "t4wp_row_start",
          "label": "Row Start (1-10)",
          "min": 1,
          "max": 10,
          "default": 1
        },
        {
          "type": "range",
          "id": "t4wp_column_start",
          "label": "Column Start (1-10)",
          "min": 1,
          "max": 10,
          "default": 1
        },
        {
          "type": "range",
          "id": "t4wp_row_end",
          "label": "Row End (1-10)",
          "min": 1,
          "max": 10,
          "default": 2
        },        
        {
          "type": "range",
          "id": "t4wp_column_end",
          "label": "Column End (1-10)",
          "min": 1,
          "max": 10,
          "default": 2
        }        
      ]
    },
    {
      "name": "Text Block",
      "type": "grid-text-item",
      "settings": [
        {
          "type": "color",
          "id": "t4wp_text_color",
          "label": "Text Color",
          "default": "#ffffff"
        },
        {
          "id": "t4wp_subtitle",
          "type": "text",
          "label": "Subheading",
          "default": "Subheading Here"
        },
        {
          "id": "t4wp_heading",  // Fixed missing quote here
          "type": "text",
          "label": "Heading",
          "default": "Title Here"
        },
        {
          "id": "t4wp_additional_text",
          "type": "textarea",
          "label": "Additional Text",
          "default": "Additional Text"
        },
        {
          "id": "t4wp_text_box_url",
          "type": "url",
          "label": "Link"
        },
        {
          "type": "range",
          "id": "t4wp_text_box_margin",
          "label": "Text Box Margin",
          "min": 0,
          "max": 50,
          "default": 5,
          "unit": "px"
        },
        {
          "type": "range",
          "id": "t4wp_text_box_padding",
          "min": 0,
          "max": 50,
          "default": 0,
          "label": "Text Box Padding",
          "unit": "px"
        },
        {
          "type": "range",
          "id": "t4wp_text_padding",
          "label": "Text Padding",
          "min": 0,
          "max": 50,
          "unit": "px",
          "default": 0
        },
        {
          "type": "header",
          "content": "Position"
        },
        {
          "type": "range",
          "id": "t4wp_row_start",
          "label": "Row Start (1-10)",
          "min": 1,
          "max": 10,
          "default": 1
        },
        {
          "type": "range",
          "id": "t4wp_column_start",
          "label": "Column Start (1-10)",
          "min": 1,
          "max": 10,
          "default": 1
        },
        {
          "type": "range",
          "id": "t4wp_row_end",
          "label": "Row End (1-10)",
          "min": 1,
          "max": 10,
          "default": 2
        },        
        {
          "type": "range",
          "id": "t4wp_column_end",
          "label": "Column End (1-10)",
          "min": 1,
          "max": 10,
          "default": 2
        }  ,
        {
          "type": "color",
          "id": "t4wp_background_color",
          "label": "Background Color",
          "default": "#ffffff"
        }
      ]
    },
    {
      "type": "video_block_grid",
      "name": "Video Block",
      "settings": [
        {
          "type": "text",
          "id": "t4wp_video_url",
          "label": "Video URL"
        },
        {
          "type": "header",
          "content": "Position"
        },
        {
          "type": "range",
          "id": "t4wp_row_start",
          "label": "Row Start (1-10)",
          "min": 1,
          "max": 10,
          "default": 1
        },
        {
          "type": "range",
          "id": "t4wp_column_start",
          "label": "Column Start (1-10)",
          "min": 1,
          "max": 10,
          "default": 1
        },
        {
          "type": "range",
          "id": "t4wp_row_end",
          "label": "Row End (1-10)",
          "min": 1,
          "max": 10,
          "default": 2
        },        
        {
          "type": "range",
          "id": "t4wp_column_end",
          "label": "Column End (1-10)",
          "min": 1,
          "max": 10,
          "default": 2
        }  
      ]
    }
  ],
  "presets": [
    {
      "name": "Image Grid Gallery",
      "category": "Custom"
    }
  ]
}
{% endschema %}

{% assign t4wp_grid_column_size = section.settings.t4wp_grid_column_size %}
{% assign t4wp_grid_gap = section.settings.t4wp_grid_gap %}
{% assign t4wp_grid_height = section.settings.t4wp_grid_height %}
{% assign t4wp_image_radius = section.settings.t4wp_image_radius %}
{% assign t4wp_container_width = section.settings.t4wp_container_width %}
{% assign t4wp_padding_top = section.settings.t4wp_padding_top %}
{% assign t4wp_padding_bottom = section.settings.t4wp_padding_bottom %}
{% assign t4wp_full_width = section.settings.t4wp_full_width %}
{% assign t4wp_remove_bottom_margin = section.settings.t4wp_remove_bottom_margin %}

<div class="t4wp_container" style="{% if t4wp_full_width %}width: 100%;{% else %}max-width: {{ t4wp_container_width }}px; margin: 0 auto;{% endif %}">
  <div class="t4wp_image-grid-gallery" style="padding-top: {{ t4wp_padding_top }}px; padding-bottom: {{ t4wp_padding_bottom }}px; {% unless t4wp_remove_bottom_margin %}margin-bottom: 90px;{% endunless %}">
    <div class="parent">
      {% for block in section.blocks %}
        {% if block.type == 'image_block' and block.settings.t4wp_image %}
          <div class="image-block"
            style="grid-column: {{ block.settings.t4wp_column_start }} / {{ block.settings.t4wp_column_end }};
            grid-row: {{ block.settings.t4wp_row_start }} / {{ block.settings.t4wp_row_end }};">
            {% if block.settings.t4wp_link %}
              <a href="{{ block.settings.t4wp_link }}" class="image-wrapper">
                <img src="{{ block.settings.t4wp_image | img_url: 'medium' }}" alt="{{ block.settings.t4wp_image.alt | escape }}" />
              </a>
            {% else %}
              <div class="image-wrapper">
                <img src="{{ block.settings.t4wp_image | img_url: 'medium' }}" alt="{{ block.settings.t4wp_image.alt | escape }}" />
              </div>
            {% endif %}
          </div>
        {% elsif block.type == 'grid-text-item' %}
          <a href="{{ block.settings.t4wp_text_box_url }}" class="text-block"
            style="grid-column: {{ block.settings.t4wp_column_start }} / {{ block.settings.t4wp_column_end }};
            grid-row: {{ block.settings.t4wp_row_start }} / {{ block.settings.t4wp_row_end }};
            padding-top: {{ block.settings.t4wp_text_box_padding }}px;
            padding-bottom: {{ block.settings.t4wp_text_box_padding }}px;
            background-color: {{ block.settings.t4wp_background_color }};
            margin: {{ block.settings.t4wp_text_box_margin }}px; text-decoration: none;">
            <h2 class="text-t4wp_subtitle" style="color: {{ block.settings.t4wp_text_color }};">
              {{ block.settings.t4wp_subtitle }}
            </h2>
            <h1 class="text-title" style="color: {{ block.settings.t4wp_text_color }};">
              {{ block.settings.t4wp_heading }} <!-- Fixed reference to t4wp_heading -->
            </h1>
            {% if block.settings.t4wp_additional_text %}
              <p class="additional-text" style="color: {{ block.settings.t4wp_text_color }};">
                {{ block.settings.t4wp_additional_text }}
              </p>
            {% endif %}
          </a>
        {% elsif block.type == 'video_block_grid' %}
          <div class="video-block"
            style="grid-column: {{ block.settings.t4wp_column_start }} / {{ block.settings.t4wp_column_end }};
            grid-row: {{ block.settings.t4wp_row_start }} / {{ block.settings.t4wp_row_end }};">
            {% assign t4wp_video_url = block.settings.t4wp_video_url %}
            
            {% if t4wp_video_url contains 'youtube.com' or t4wp_video_url contains 'youtu.be' %}
              <iframe class="video-wrapper" width="100%" height="100%" src="{{ t4wp_video_url | replace: 'watch?v=', 'embed/' | replace: 'youtu.be/', 'embed/' }}" frameborder="0" allowfullscreen></iframe>
            
            {% elsif t4wp_video_url contains 'vimeo.com' %}
              <iframe class="video-wrapper" width="100%" height="100%" src="{{ t4wp_video_url | replace: 'vimeo.com/', 'player.vimeo.com/video/' }}" frameborder="0" allowfullscreen></iframe>
            
            {% else %}
              <div class="video-wrapper">
                <video controls>
                  <source src="{{ t4wp_video_url }}" type="video/mp4">
                  Your browser does not support the video tag.
                </video>
              </div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>
</div>

<style>
  /* Parent grid container */
  .parent {
    display: grid;
    grid-template-columns: repeat({{ t4wp_grid_column_size }}, 1fr);
    grid-template-rows: auto;
    gap: {{ t4wp_grid_gap }}px;  /* Fixed reference to t4wp_grid_gap */
    height: {{ t4wp_grid_height }}px;
  }

  /* Image block */
  .image-block {
    overflow: hidden;
    border-radius: {{ t4wp_image_radius }}px;
    height: 100%;
  }

  .image-wrapper {
    display: block;
    width: 100%;
    height: 100%;
    border-radius: {{ t4wp_image_radius }}px;
    overflow: hidden;
  }

  .image-wrapper img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .image-wrapper img:hover {
    transform: scale(1.1);
  }

  /* Text block */
  .text-block {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    border-radius: {{ t4wp_image_radius }}px;
    cursor: pointer; /* Make it look clickable */
  }

  .text-title,
  .text-t4wp_subtitle {
    margin: 0; /* Reset default margins to ensure consistent spacing */
  }

  .additional-text {
    font-size: 16px; /* Adjust the font size as needed */
    margin-top: 10px; /* Space between t4wp_subtitle/title and additional text */
  }

  .t4wp_container {
    margin: 0 auto;
  }

  .video-block {
    border-radius: {{ t4wp_image_radius }}px;
  }

  /* Mobile responsiveness */
  @media only screen and (max-width: 768px) {
    .image-wrapper img {
      transform: scale(1.1) !important;
    }

    .image-wrapper, .image-block, .text-block {
      border-radius: 0px !important;
    }

    .parent {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: auto;
      gap: 0px !important;
    }

    .t4wp_container {
      width: auto;
    }
  }
</style>
